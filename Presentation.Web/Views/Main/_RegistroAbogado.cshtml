@model Application.DTO.Models.Usuario
@using resources = Infrastructure.Resources;

@{
    bool IsAbogado = (bool)ViewBag.IsAbogado;

    var FormatosPermitidos = ViewBag.FormatosPermitidos as IList<Application.DTO.Models.AsocTipoDocumentoAdjunto>;
}

<script type="text/javascript">

    var SolicitaHabilitar = false;

    ; (function ($) {
        $(function () {
            fixFakePath("archivo");

            $(".xCheckbox").bootstrapSwitch({
                onSwitchChange: function (event, state) {
                    if (state) {
                        $("#divSolicita").show();
                        $("#divTelefono").show();
                        SolicitaHabilitar = true;
                    } else {
                        $("#divSolicita").hide();
                        $("#divTelefono").hide();
                        SolicitaHabilitar = false;
                    }
                }
            });

            activateForm("btnAceptar", "frmRegistroAbogado",
               function () {

                   if (!SolicitaHabilitar) {
                       showBlockUIError("Para el envío de su solicitud, debe indicar que quiere registrarse");
                       return false;
                   }

                   if (!$("#checkDeclarar").is(":checked")) {
                       showBlockUIError("Debe declarar contar con los requisitos solicitados");
                       return false;
                   }

                   if ($("#archivo").val() == "") {
                       showBlockUIError("Debe cargar el certificado de título");
                       return false;
                   }

                   $("#frmFileExpediente").submit();

                   return true;
               },
               function () {

                   showBlockUI(CloseDialog);

               });

            SetUploadForm();
            ValidarTelefonos();

        });
    })(jQuery);

    function SetUploadForm() {

        activateFormUploadFile({
            formID: "frmFileExpediente",
            callback: function () {

                //CloseDialog();              
            }
        })
    }

</script>

<div class="modal-body" style="padding-top: 6px;">

    @if (IsAbogado)
    {
        <fieldset class="x-fieldset">
            @Html.Raw(Html.GetInfoVentanaIpsum("Usted está confirmado como Abogado"))

        </fieldset>
    }
    else
    {

       <fieldset class="x-fieldset">
           @Html.Raw(Html.GetInfoVentana(Domain.Infrastructure.TipoVentana.RegistroAbogado))

           <form class="form-horizontal " id="frmRegistroAbogado" method="post" action="@Url.Action("SolicitudRegistroAbogado", "Main")">
               @Html.AntiForgeryToken()
               @Html.HiddenFor(x => x.UsuarioID)               

               <div class="form-group row align-items-center">
                   <label for="" class="col-md-4 col-form-label">Quiero Registrarme</label>
                   <div class="col-md-6">
                       @Html.Raw(Html.MyCheckbox(false, "IsSolicitaHabilitacion", 0, "", "small", 0, false, false, ""))
                   </div>
               </div>

               <div class="form-group row align-items-center" id="divTelefono" style="display:none;">
                   <label for="" class="col-md-4 col-form-label">Teléfono <span class="span-obligatorio">*</span></label>
                   <div class="col-md-6">
                       @Html.TextBoxFor(x => x.Telefono, new { @class = "form-control verificar", @style = "", @placeholder = "Ej. 56987654321", @maxlength = "20" })
                   </div>
               </div>
              
           </form>
       </fieldset>

    <div id="divSolicita"  style="display:none;">

        <fieldset class="x-fieldset">
            <legend class="celeste bold">Certificado de Título</legend>

            <form class="" id="frmFileExpediente" enctype="multipart/form-data" action="@Url.Action("SubirArchivo", "Uploader")" method="POST">
                @Html.AntiForgeryToken()

                <input type="hidden" id="_TipoDocumentoID" name="TipoDocumentoID" value="@Html.EnumToInt(Domain.Infrastructure.TipoDocumento.CertificadoTituloAbogado)" />


                <div class="input-group">
                    <div class="custom-file">
                        <input type="file" class="custom-file-input notBlock" id="archivo" name="file">
                        <label class="custom-file-label" for="file"
                               data-browse="@resources.UploadFiles.FileInput_changeText"
                               aria-describedby="inputGroupFileAddon">@resources.UploadFiles.FileInput_inputText</label>
                        </div>
                    </div>

                    <small id="" class="form-text text-muted ac" style="margin-bottom: 10px;">
                        @resources.GlobalResources.ExtensionesPermitidas: @Html.Raw(Html.GetExtensionesPermitidas(FormatosPermitidos, IncluyeTamanio: true))
                    </small>

                </form>
            </fieldset>

            <div class="alert alert-danger ac" role="alert" style="margin-top:5px;">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="checkDeclarar" value="1">
                    <label class="form-check-label" for="checkDeclarar"> Declaro contar con todos los requisitos necesarios para registrarme como abogado/a en esta plataforma.</label>
                </div>
            </div>
        </div>
    }



</div>

<div class="modal-footer">

    @if (!IsAbogado)
    {
        <button id="btnAceptar" class="btn btn-default" onclick="$('#frmRegistroAbogado').submit()" type="button">
            <i class="x-icon x-icon-save2 icon-in-button"></i> @resources.GlobalResources.BtnEnviar
        </button>

        <i class="x-icon-loader hide"></i>
    }
    else
    {
        <button class="btn btn-default" data-dismiss="modal" type="button">
            <i class="x-icon x-icon-save2 icon-in-button"></i> @resources.GlobalResources.BtnAceptar
        </button>
    }
    

    <button class="btn btn-default" data-dismiss="modal" type="button">
        <i class="x-icon x-icon-cancel2 icon-in-button"></i> @resources.GlobalResources.BtnCancelar
    </button>

</div>